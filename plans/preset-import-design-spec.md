# Clotho é¢„è®¾å¯¼å…¥ä¸ Prompt æ’åºæ˜ å°„è®¾è®¡ (Design Spec)

**ç‰ˆæœ¬**: 0.1.0  
**æ—¥æœŸ**: 2025-12-27  
**çŠ¶æ€**: Draft  
**ä½œè€…**: Roo (Architect Mode)

## 1. æ¦‚è¿°

æœ¬è®¾è®¡æ—¨åœ¨è§£å†³ SillyTavern å¤æ‚é¢„è®¾ï¼ˆä»¥ "GrayWill" ä¸ºä¾‹ï¼‰å¯¼å…¥ Clotho ç³»ç»Ÿæ—¶çš„ **Prompt ç¼–æ’ä¸æ’åºæ˜ å°„** é—®é¢˜ã€‚ä¸åŒäºç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼ŒClotho çš„ Jacquard ç¼–æ’å±‚æ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„æµæ°´çº¿ï¼Œéœ€è¦å°† ST çš„ `prompt_order` é€»è¾‘ç²¾ç¡®æ˜ å°„åˆ° Jacquard çš„ `InjectionConfig` ä¸­ã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ª **"é¢„è®¾å¯¼å…¥å‘å¯¼" (Preset Import Wizard)**ï¼Œå¼•å¯¼ç”¨æˆ·å®Œæˆè¿™ä¸€å¤æ‚çš„é…ç½®æ˜ å°„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¾èµ–ä¸é€æ˜çš„è‡ªåŠ¨è½¬æ¢ã€‚

## 2. Prompt æ’åºé€»è¾‘åˆ†æä¸æ˜ å°„

### 2.1 æºæ•°æ®ç»“æ„ (`é¢„è®¾å¯¼å…¥.json`)

ST çš„ Prompt ç³»ç»Ÿç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š
1.  **`prompts` æ•°ç»„**: å®šä¹‰äº†æ‰€æœ‰å¯ç”¨çš„ Prompt å—ï¼ŒåŒ…å«å†…å®¹ã€è§’è‰²ã€å¯ç”¨çŠ¶æ€ä»¥åŠ `injection_position` (è™½åä¸º positionï¼Œä½†åœ¨ ST ä¸­æ›´å¤šä¾èµ– order)ã€‚
2.  **`prompt_order` æ•°ç»„**: æ˜¾å¼å®šä¹‰äº†ç‰¹å®šè§’è‰² (Character ID) ä¸‹ Prompt çš„**çº¿æ€§é¡ºåº**ã€‚

**å…³é”®å‘ç°**:
åœ¨æä¾›çš„ `é¢„è®¾å¯¼å…¥.json` ä¸­ï¼Œ`prompt_order` å®é™…ä¸Šå®šä¹‰äº†ä¸€ä¸ª**ç»å¯¹é¡ºåº**åˆ—è¡¨ï¼š
```json
"prompt_order": [
    {
        "character_id": 100001,
        "order": [
            { "identifier": "worldInfoBefore", "enabled": true },
            { "identifier": "740fdc64...", "enabled": true },
            { "identifier": "charDescription", "enabled": true },
            // ... æ›´å¤šé¡¹
        ]
    }
]
```
è¿™æ„å‘³ç€ Jacquard ä¸éœ€è¦å¤æ‚çš„ç›¸å¯¹è®¡ç®—ï¼Œè€Œæ˜¯éœ€è¦æ”¯æŒä¸€ç§ **"åŸºäºåˆ—è¡¨çš„ç»å¯¹æ’åºç­–ç•¥" (List-based Absolute Ordering)**ã€‚

### 2.2 Jacquard æ˜ å°„ç­–ç•¥

Clotho çš„ `Skein Builder` æ”¯æŒå¤šç§æ³¨å…¥ç­–ç•¥ã€‚æˆ‘ä»¬å°†å¼•å…¥ä¸€ç§æ–°çš„ç­–ç•¥é€‚é…å™¨ï¼š**`SequenceInjectionStrategy`**ã€‚

#### 2.2.1 æ˜ å°„è§„åˆ™è¡¨

| ST æ¦‚å¿µ | Clotho æ¦‚å¿µ | æ˜ å°„é€»è¾‘ |
| :--- | :--- | :--- |
| `prompts[i]` | `PromptBlock` | å†…å®¹è½¬åŒ–ä¸º Jinja2 æ¨¡æ¿ï¼ŒID ä¿æŒä¸€è‡´ã€‚ |
| `prompt_order` | `InjectionConfig.sequence` | å¯¼å…¥æ—¶è¯»å– Order åˆ—è¡¨ï¼Œç”Ÿæˆä¸€ä¸ªå…¨å±€çš„ Sequence Indexã€‚ |
| `injection_depth` | `InjectionConfig.depth` | å¦‚æœå­˜åœ¨æ·±åº¦è®¾ç½®ï¼Œè½¬åŒ–ä¸º Jacquard çš„ `relativeToEnd` åç§»é‡ã€‚ |
| `role` | `BlockRole` | `system` -> `System`, `user` -> `User`, `assistant` -> `Assistant`ã€‚ |

#### 2.2.2 åºåˆ—åŒ–å¤„ç†æµç¨‹

1.  **æ‰å¹³åŒ–**: è¯»å– `prompt_order` ä¸­çš„æ‰€æœ‰ identifierã€‚
2.  **ç´¢å¼•åŒ–**: ä¸ºæ¯ä¸ª identifier åˆ†é…ä¸€ä¸ª `sequence_index` (0, 1, 2...)ã€‚
3.  **é…ç½®ç”Ÿæˆ**: åœ¨æ„å»º `PromptBlock` æ—¶ï¼Œå°† `sequence_index` å†™å…¥å…¶å…ƒæ•°æ®ã€‚
*   è¿è¡Œæ—¶æ’åº: Jacquard çš„ `Assembler` é˜¶æ®µä½¿ç”¨ `sequence_index` ä½œä¸ºä¸»æ’åºé”®ã€‚

### 2.3 æ‰‹åŠ¨åˆ†ç»„åŠŸèƒ½ (Manual Grouping)

ç”±äºä¸åŒé¢„è®¾çš„å‘½åè§„å¾‹å·®å¼‚å·¨å¤§ï¼ˆå¦‚ "Yuan" ä½¿ç”¨ Emojiï¼Œ"GrayWill" ä½¿ç”¨ä¸­æ–‡åç¼€ï¼‰ï¼Œè‡ªåŠ¨è¯†åˆ«ç®—æ³•éš¾ä»¥å¯é å·¥ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬æä¾›**çº¯æ‰‹åŠ¨åˆ†ç»„å·¥å…·**ã€‚

#### 2.3.1 åˆ†ç»„æ•°æ®ç»“æ„

```typescript
interface PromptGroup {
id: string;
title: string; // ç”¨æˆ·è‡ªå®šä¹‰çš„åˆ†ç»„åç§°ï¼Œå¦‚ "æ€ç»´é“¾" æˆ– "æ¨¡å‹é€‰æ‹©"
icon?: string; // ç”¨æˆ·å¯é€‰æ‹© Emoji ä½œä¸ºå›¾æ ‡
items: string[]; // Prompt Block çš„ identifier åˆ—è¡¨
selectionMode: 'single' | 'multiple' | 'none'; // ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®
}
```

#### 2.3.2 UI äº¤äº’è®¾è®¡

åœ¨ **æ­¥éª¤ 2: Prompt å—ç­›é€‰** ä¸­ï¼Œå¢åŠ åˆ†ç»„ç®¡ç†åŠŸèƒ½ï¼š

```text
+-------------------------------------------------------+
|  Prompt Block Selection (Step 2/4)                     |
+-------------------------------------------------------+
|                                                       |
|  [+] åˆ›å»ºæ–°åˆ†ç»„                                      |
|                                                       |
|  åˆ†ç»„: [æ€ç»´é“¾ â–¼] (å•é€‰) [ç¼–è¾‘] [åˆ é™¤]           |
|  +-------------------------------------------------+ |
|  | ğŸThinking(Medium)     [x] [::] [x]           | |
|  | ğŸ’¬ç®€ç»ƒæ€è€ƒ           [ ] [::] [x]           | |
|  +-------------------------------------------------+ |
|                                                       |
|  åˆ†ç»„: [è¾“å‡ºæ¨¡æ¿ â–¼] (å¤šé€‰) [ç¼–è¾‘] [åˆ é™¤]           |
|  +-------------------------------------------------+ |
|  | ğŸ“—è¾“å‡ºæ¨¡æ¿(æœ‰é¢„å¡«å……) [x] [::] [x]         | |
|  | ğŸ“˜å°æ€»ç»“             [ ] [::] [x]           | |
|  +-------------------------------------------------+ |
|                                                       |
|  æœªåˆ†ç»„:                                               |
|  +-------------------------------------------------+ |
|  | Main Prompt            [ ] [::] [x]           | |
|  | Auxiliary Prompt       [ ] [::] [x]           | |
|  +-------------------------------------------------+ |
|                                                       |
|  [::] = ä»ç»„ä¸­ç§»é™¤  [x] = å¯ç”¨/ç¦ç”¨                |
|                                                       |
|  [< Back]                                   [Next >]  |
+-------------------------------------------------------+
```

#### 2.3.3 æ“ä½œè¯´æ˜

1.  **åˆ›å»ºåˆ†ç»„**: ç”¨æˆ·ç‚¹å‡» `[+] åˆ›å»ºæ–°åˆ†ç»„`ï¼Œè¾“å…¥åç§°å’Œé€‰æ‹©æ¨¡å¼ï¼ˆå•é€‰/å¤šé€‰/æ— é™åˆ¶ï¼‰ã€‚
2.  **æ·»åŠ åˆ°åˆ†ç»„**: ç”¨æˆ·å¯ä»¥æ‹–æ‹½æœªåˆ†ç»„çš„ Prompt åˆ°ç°æœ‰åˆ†ç»„ä¸­ã€‚
3.  **ä»ç»„ä¸­ç§»é™¤**: ç‚¹å‡» `[::]` å›¾æ ‡å°† Prompt ç§»å‡ºåˆ†ç»„ã€‚
4.  **ç¼–è¾‘åˆ†ç»„**: ä¿®æ”¹åˆ†ç»„åç§°æˆ–åˆ‡æ¢é€‰æ‹©æ¨¡å¼ã€‚
5.  **åˆ é™¤åˆ†ç»„**: åˆ é™¤åˆ†ç»„åï¼Œç»„å†…æ‰€æœ‰ Prompt å›åˆ°"æœªåˆ†ç»„"çŠ¶æ€ã€‚

## 3. é¢„è®¾å¯¼å…¥å‘å¯¼ (Preset Import Wizard) UI/UX è®¾è®¡

ä¸ºäº†è®©ç”¨æˆ·ç›´è§‚åœ°æŒæ§è¿™ä¸€è¿‡ç¨‹ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªåˆ†æ­¥å‘å¯¼ã€‚

### 3.1 æµç¨‹å›¾ (Mermaid)

```mermaid
graph TD
    Start[å¼€å§‹å¯¼å…¥ JSON] --> Step1_Analyze[æ­¥éª¤ 1: ç»“æ„åˆ†æ]
    Step1_Analyze --> Step2_BlockSelect[æ­¥éª¤ 2: Prompt å—ç­›é€‰]
    Step2_BlockSelect --> Step3_OrderMap[æ­¥éª¤ 3: æ’åºå¯è§†åŒ–æ ¡å¯¹]
    Step3_OrderMap --> Step4_VarMap[æ­¥éª¤ 4: å˜é‡ä¸è„šæœ¬æ˜ å°„]
    Step4_VarMap --> Finish[ç”Ÿæˆ Clotho é¢„è®¾]

    subgraph "Step 3: æ’åºå¯è§†åŒ–"
        List[ST åŸå§‹é¡ºåºåˆ—è¡¨]
        Preview[Clotho æœ€ç»ˆåˆæˆé¢„è§ˆ]
        Drag[æ‹–æ‹½è°ƒæ•´é¡ºåº]
        
        List --> Drag --> Preview
    end
```

### 3.2 ç•Œé¢äº¤äº’ç»†èŠ‚

#### **æ­¥éª¤ 1: æ¦‚è§ˆä¸åˆ†æ (Overview)**
*   **æ˜¾ç¤º**: æ£€æµ‹åˆ°çš„ Prompt æ•°é‡ã€Regex è„šæœ¬æ•°é‡ã€Quick Replies ç­‰ã€‚
*   **è­¦å‘Š**: æ ‡å‡ºæ— æ³•è‡ªåŠ¨è¿ç§»çš„é«˜é£é™©è„šæœ¬ (å¦‚ `cmd(eval)` )ï¼Œæç¤ºç”¨æˆ·éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚

#### **æ­¥éª¤ 2: Prompt å—ç­›é€‰ä¸åˆ†ç»„ (Block Selection & Grouping)**
*   **å·¦ä¾§**: ST åŸæœ‰çš„ Prompt åˆ—è¡¨ (å¦‚ "main", "nsfw", "jailbreak" ä»¥åŠè‡ªå®šä¹‰çš„ "ç°é­‚" å—)ã€‚
*   **å³ä¾§**: è¯¦æƒ…ç¼–è¾‘åŒºã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å†…å®¹ï¼Œå¹¶å†³å®šæ˜¯å¦å¯¼å…¥è¯¥å—ã€‚
*   **åˆ†ç»„åŠŸèƒ½**:
    *   **åˆ›å»ºåˆ†ç»„**: ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰åˆ›å»ºåˆ†ç»„ï¼Œè®¾ç½®åˆ†ç»„åç§°å’Œé€‰æ‹©æ¨¡å¼ï¼ˆå•é€‰/å¤šé€‰ï¼‰ã€‚
    *   **æ‹–æ‹½ç®¡ç†**: æ”¯æŒå°† Prompt æ‹–å…¥æˆ–æ‹–å‡ºåˆ†ç»„ã€‚
    *   **çµæ´»é…ç½®**: åˆ†ç»„å†…çš„ Prompt å¯ä»¥è®¾ç½®ä¸ºäº’æ–¥ï¼ˆå•é€‰ï¼‰æˆ–éäº’æ–¥ï¼ˆå¤šé€‰ï¼‰ï¼Œå®Œå…¨ç”±ç”¨æˆ·å†³å®šã€‚
*   **åŠŸèƒ½**: æ”¯æŒæ‰¹é‡å‹¾é€‰/å–æ¶ˆå‹¾é€‰ã€‚

#### **æ­¥éª¤ 3: æ’åºç¼–æ’ (Sequence Orchestration) [æ ¸å¿ƒ]**
è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚
*   **ç•Œé¢**: ä¸€ä¸ªå‚ç›´çš„ã€å¯æ‹–æ‹½çš„åˆ—è¡¨ (ReorderableListView)ã€‚
*   **æ•°æ®æº**: åˆå§‹åŒ–ä¸º `prompt_order` ä¸­çš„é¡ºåºã€‚
*   **åˆ†ç»„å±•ç¤º**: åœ¨æ’åºç•Œé¢ä¸­ï¼Œå·²åˆ†ç»„çš„ Prompt å¯ä»¥æŠ˜å æ˜¾ç¤ºï¼Œå‡å°‘è§†è§‰æ··ä¹±ã€‚
*   **ç‰¹æ®Šå—**:
    *   å°† `CharDesc` (è§’è‰²æè¿°), `WorldInfo` (ä¸–ç•Œä¹¦), `ChatHistory` (èŠå¤©è®°å½•) ä½œä¸º**å›ºå®šé”šç‚¹ (Anchors)** æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­ã€‚
    *   ç”¨æˆ·å¯ä»¥å°†è‡ªå®šä¹‰ Prompt (å¦‚ "ç°é­‚æ€ç»´é“¾") æ‹–æ‹½åˆ° "ChatHistory" ä¹‹å‰æˆ–ä¹‹åã€‚
*   **æ·±åº¦æ§åˆ¶**: å¯¹äºéœ€è¦æ’å…¥åˆ°èŠå¤©è®°å½•æœ«å°¾çš„ Prompt (Depth æ³¨å…¥)ï¼Œæä¾›ä¸€ä¸ªå•ç‹¬çš„ "Depth Zone" åŒºåŸŸè¿›è¡Œé…ç½®ã€‚

#### **æ­¥éª¤ 4: å˜é‡æ˜ å°„ (Variable Mapping)**
*   **è‡ªåŠ¨è¯†åˆ«**: æ‰«æå†…å®¹ä¸­çš„ `{{user}}`, `{{char}}` ç­‰ ST å®ã€‚
*   **æ˜ å°„è¡¨**:
    *   `{{user}}` -> `{{ user_name }}`
    *   `{{char}}` -> `{{ char_name }}`
    *   `{{lastMessage}}` -> `{{ history.last }}`
*   **æ‰‹åŠ¨ä¿®æ­£**: å¯¹äºæ— æ³•è¯†åˆ«çš„å®ï¼Œå…è®¸ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥å¯¹åº”çš„ Jinja2 è¡¨è¾¾å¼ã€‚

## 5. é«˜çº§è¿ç§»ï¼šRegex è„šæœ¬ä¸ JS å¹²æ¶‰å¤„ç†

é’ˆå¯¹ "GrayWill" ç­‰é«˜çº§é¢„è®¾ä¸­åŒ…å«çš„ Regex UI ä¿®æ”¹å’Œ JS è„šæœ¬å¹²æ¶‰ï¼Œå‘å¯¼æä¾›ä¸€å¥—**åŠè‡ªåŠ¨åŒ–çš„è¿ç§»ç­–ç•¥**ã€‚

### 5.1 ç­–ç•¥æ¦‚è§ˆ

| æºç±»å‹ (ST) | å…¸å‹ç”¨é€” | é£é™© | ç›®æ ‡ç±»å‹ (Clotho Filament) | è¿ç§»æ–¹å¼ |
| :--- | :--- | :--- | :--- | :--- |
| **Regex Script** | æ›¿æ¢ UI æ–‡æœ¬ã€éšè—å…ƒç´ ã€æ³¨å…¥ CSS | ä½ (ä¸»è¦å½±å“å±•ç¤º) | `<choice>` æ ‡ç­¾ / Native Theme | **è¯­ä¹‰æå–**: è¯†åˆ« Regex çš„æ„å›¾ï¼ˆå¦‚â€œæä¾›é€‰é¡¹â€ï¼‰ï¼Œè½¬æ¢ä¸ºç»“æ„åŒ–çš„ Filament æ ‡ç­¾ã€‚ |
| **JS Script** | `alert()`, `shake()`, `cmd()` | é«˜ (ä»»æ„ä»£ç æ‰§è¡Œ) | `<ui_component>` / `<tool_call>` | **ç™½åå•æ˜ å°„**: å°†å®‰å…¨çš„ DOM æ“ä½œæ˜ å°„ä¸ºæ ‡å‡†çš„ UI ç»„ä»¶æŒ‡ä»¤ï¼›é˜»æ–­ä¸å®‰å…¨çš„ `eval`ã€‚ |

### 5.2 Regex -> Choice Tag è½¬æ¢å™¨

ST å¸¸é€šè¿‡ Regex åŒ¹é…ç‰¹å®šè¾“å‡ºå¹¶åœ¨ UI ä¸Šæ¸²æŸ“æŒ‰é’®ã€‚Clotho åŸç”Ÿæ”¯æŒè¿™ä¸€åŠŸèƒ½ã€‚

**å‘å¯¼ç•Œé¢é€»è¾‘**:
1.  **æ‰«æ**: æ£€æµ‹ `script` å­—æ®µæˆ– `regex_scripts` æ•°ç»„ã€‚
2.  **è¯†åˆ«**: å¯»æ‰¾ç±»ä¼¼ `/<(\d)>(.*?)<\/\1>/` çš„æ¨¡å¼ï¼ˆç”¨äºæå–é€‰é¡¹æ–‡æœ¬ï¼‰ã€‚
3.  **å»ºè®®**: å¼¹çª—æç¤º "æ£€æµ‹åˆ°æ¨¡æ‹Ÿé€‰é¡¹çš„æ­£åˆ™è„šæœ¬ï¼Œæ˜¯å¦è½¬æ¢ä¸º Filament Choice ç»„ä»¶ï¼Ÿ"
4.  **è½¬æ¢**:
    *   **ST Regex**: `/<(\d)>(.*?)<\/\1>/g`
    *   **Clotho Template**: å»ºè®®ç”¨æˆ·åœ¨ System Prompt ä¸­åŠ å…¥ instruction: 
        `"å½“éœ€è¦ç”¨æˆ·é€‰æ‹©æ—¶ï¼Œè¯·è¾“å‡º <choice id='1'>é€‰é¡¹å†…å®¹</choice>"`

### 5.3 JS å¹²æ¶‰æ˜ å°„è¡¨é…ç½®

åœ¨å‘å¯¼çš„ "Advanced" æ­¥éª¤ä¸­ï¼Œæä¾›ä¸€ä¸ªæ˜ å°„é…ç½®è¡¨ï¼š

*   **æºå‡½æ•°**: `alert(msg)`
    *   **ç›®æ ‡ç»„ä»¶**: `<ui_component type="toast" level="info">{{msg}}</ui_component>`
*   **æºå‡½æ•°**: `shake(intensity)`
    *   **ç›®æ ‡ç»„ä»¶**: `<ui_component type="effect.shake" intensity="{{intensity}}" />`
*   **æºå‡½æ•°**: `cmd(code)`
    *   **åŠ¨ä½œ**: **DROP (ä¸¢å¼ƒ)** (é»˜è®¤) æˆ– **MANUAL (æ‰‹åŠ¨é‡å†™)**
    *   *æ³¨: å‘å¯¼ä¼šç”¨çº¢è‰²é«˜äº®æ˜¾ç¤ºæ‰€æœ‰ `cmd` è°ƒç”¨ï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ· Clotho ä¸æ”¯æŒ `eval`ï¼Œå¿…é¡»é‡å†™ä¸ºç‰¹å®šçš„ Tool Callã€‚*

## 7. é¢„è®¾å¯¼å…¥å‘å¯¼ UI çº¿æ¡†å›¾

ä¸ºäº†æ›´ç›´è§‚åœ°å±•ç¤ºå¯¼å…¥æµç¨‹ï¼Œä»¥ä¸‹æ˜¯åŸºäº Mermaid çš„ UI çŠ¶æ€æµè½¬ä¸ç•Œé¢ç»“æ„å›¾ã€‚

### 7.1 ç•Œé¢ç»“æ„æ¦‚è§ˆ

```mermaid
classDiagram
    class ImportWizard {
        +Step currentStep
        +PresetData rawData
        +ClothoConfig targetConfig
        +next()
        +back()
        +finish()
    }

    class Step1_Analysis {
        <<Widget>>
        +OverviewCard stats
        +WarningList criticalIssues
    }

    class Step2_BlockSelection {
        <<Widget>>
        +CheckboxList promptBlocks
        +CodePreview blockContent
    }

    class Step3_SequenceEditor {
        <<Widget>>
        +ReorderableList mainSequence
        +DropZone depthInjectionZone
        +AnchorItem systemAnchors
        +Button applyOriginalOrder // æ–°å¢ï¼šä¸€é”®æ¢å¤ ST é¡ºåº
    }

    class Step4_MappingConfig {
        <<Widget>>
        +DataTable variableMap
        +DataTable scriptMap
        +CodeEditor customJinja
    }

    ImportWizard *-- Step1_Analysis
    ImportWizard *-- Step2_BlockSelection
    ImportWizard *-- Step3_SequenceEditor
    ImportWizard *-- Step4_MappingConfig
```

### 7.2 æ ¸å¿ƒç•Œé¢ï¼šPrompt æ’åºç¼–æ’å™¨ (Step 3)

è¿™æ˜¯ä¸€ä¸ªå‚ç›´çš„æ‹–æ‹½æ’åºåˆ—è¡¨ï¼Œæ¨¡æ‹Ÿäº†æœ€ç»ˆçš„ Prompt ç»„è£…é¡ºåºã€‚

**é»˜è®¤è¡Œä¸º**:
è¿›å…¥æ­¤æ­¥éª¤æ—¶ï¼Œç³»ç»Ÿå°†**è‡ªåŠ¨è§£æå¹¶åº”ç”¨** `prompt_order` ä¸­çš„åŸå§‹é¡ºåºã€‚åˆ—è¡¨å°†ç²¾ç¡®åæ˜  ST ä¸­çš„ç¼–æ’ï¼Œç”¨æˆ·ä»…éœ€åœ¨éœ€è¦å¾®è°ƒæ—¶è¿›è¡Œæ‹–æ‹½ã€‚

```text
+-------------------------------------------------------+
|  Prompt Sequence Editor (Step 3/4)                    |
+-------------------------------------------------------+
|  [ Info ] Order auto-filled from ST preset.           |
|  [ Button ] Restore Original ST Order (Reset)         |
|                                                       |
|  [ Anchor ]  --- System Start ---                     |
|  [ Fixed  ]  World Info (Before) (ST Pos: 0)          |
|  [ Fixed  ]  Character Card Spec (ST Pos: 1)          |
|  [ Fixed  ]  Scenario            (ST Pos: 2)          |
|                                                       |
|  [ DRAGABLE ] ç°é­‚åŸºæœ¬è®¾å®š (GrayWill)  [::] [x]       |
|  [ DRAGABLE ] æ€ç»´é“¾å‰ç½® (COT_Pre)     [::] [x]       |
|                                                       |
|  [ Anchor ]  --- Context Window ---                   |
|  [ Fixed  ]  Chat History                             |
|                                                       |
|  [ DRAGABLE ] ç°é­‚æ€ç»´é“¾ (COT_Main)    [::] [x]       |
|  [ DRAGABLE ] æ”»å‡»è„šæœ¬ (Attack_Script) [::] [x]       |
|                                                       |
|  [ Zone   ]  --- Depth Injection (RelativeToEnd) ---  |
|  |  [ DRAGABLE ] è¶Šç‹±æŒ‡ä»¤ (Jailbreak)  (Depth: 4) |   |
|  +----------------------------------------------------+
|                                                       |
|  [< Back]                                   [Next >]  |
+-------------------------------------------------------+
```

*   **[ Anchor ]**: å›ºå®šé”šç‚¹ï¼Œä¸å¯ç§»åŠ¨ï¼Œä»£è¡¨ Jacquard æµæ°´çº¿çš„ç¡¬æ€§é˜¶æ®µã€‚
*   **[ Fixed ]**: æ ¸å¿ƒç»„ä»¶ï¼Œå»ºè®®ä½ç½®å›ºå®šï¼Œä½†åœ¨é«˜çº§æ¨¡å¼ä¸‹å¯è§£é”ã€‚
*   **[ DRAGABLE ]**: ç”¨æˆ·è‡ªå®šä¹‰çš„ Prompt å—ï¼Œå¯è‡ªç”±æ‹–æ‹½ã€‚
*   **[ Zone ]**: æ·±åº¦æ³¨å…¥åŒºï¼Œä¸“é—¨å¤„ç† `injection_depth` > 0 çš„å—ã€‚

## 8. Prompt ç»“æ„è¿ç§»ç¤ºä¾‹

### 8.1 æºæ•°æ® (ST JSON)
```json
{
    "identifier": "enhanceDefinitions",
    "content": "Ensure logic is sound.",
    "injection_position": 0, // å®é™…ä¸Šä¾èµ– prompt_order
    "enabled": true
}
```

### 4.2 ç›®æ ‡æ•°æ® (Clotho YAML/Filament)
```yaml
- id: "enhanceDefinitions"
  role: "system"
  content: "Ensure logic is sound."
  injection:
    strategy: "sequence"
    index: 5  # ç”±å‘å¯¼æ ¹æ® prompt_order è‡ªåŠ¨è®¡ç®—
  tags: ["preset:graywill"]
```

## 5. å¾…ç¡®è®¤é¡¹ (TBD)

1.  **å¤šè§’è‰²é¡ºåº**: `prompt_order` ä¼¼ä¹æ”¯æŒé’ˆå¯¹ä¸åŒè§’è‰² ID è®¾ç½®ä¸åŒé¡ºåºã€‚Clotho æ˜¯å¦éœ€è¦æ”¯æŒè¿™ç§ç»†ç²’åº¦ï¼Ÿå»ºè®® V1 ç‰ˆæœ¬åªæ”¯æŒ**å…¨å±€é€šç”¨é¡ºåº**ã€‚
2.  **Regex è„šæœ¬å¤„ç†**: å‘å¯¼æ˜¯å¦éœ€è¦æä¾›ä¸€ä¸ªç®€æ˜“çš„ Regex -> `<ui_component>` è½¬æ¢å™¨ï¼Ÿç›®å‰å»ºè®®åœ¨â€œé«˜çº§è®¾ç½®â€ä¸­æ‰‹åŠ¨å¤„ç†ã€‚

